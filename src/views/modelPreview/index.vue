<template>
  <div id="preview">
    <!-- <tree-component /> -->
    <iframe  width="100%" height="100%" src="https://zhang_6666.gitee.io/three.js3d/preview?modelConfig={'background':{'visible':true,'type':3,'image':'/three.js3d/static/img/model-bg-3.6c273dac.jpg','viewImg':'/three.js3d/static/img/view-4.46878642.png','color':'#000','blurriness':1,'intensity':1},'material':{'materialType':'','meshList':[{'meshName':'Mesh_0254_Tex_0253_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0258_Tex_0253_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0260_Tex_0253_0dd2_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0272_Tex_0271_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275001_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275002_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275003_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0272001_Tex_0271_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0254001_Tex_0253_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0258001_Tex_0253_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0272002_Tex_0271_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275004_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275005_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0275006_Tex_0271_0dd1_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'},{'meshName':'Mesh_0272003_Tex_0271_0dds_0','color':'rgb(255,255,255)','opacity':1,'depthWrite':true,'wireframe':false,'visible':true,'type':'MeshStandardMaterial'}]},'animation':{'visible':false,'animationName':null,'loop':'LoopRepeat','timeScale':1,'weight':1,'rotationVisible':false,'rotationType':'y','rotationSpeed':1},'attribute':{'visible':true,'skeletonHelper':false,'gridHelper':false,'x':0,'y':-0.59,'z':-0.1,'positionX':0,'positionY':-1,'positionZ':0,'divisions':18,'size':6,'color':'rgb(193,193,193)','axesHelper':false,'axesSize':1.8,'rotationX':0,'rotationY':0,'rotationZ':0},'light':{'planeGeometry':false,'planeColor':'#000000','planeWidth':7,'planeHeight':7,'ambientLight':true,'ambientLightColor':'#fff','ambientLightIntensity':0.8,'directionalLight':false,'directionalLightHelper':true,'directionalLightColor':'#fff','directionalLightIntensity':5,'directionalHorizontal':-1.26,'directionalVertical':-3.85,'directionalSistance':2.98,'directionaShadow':true,'pointLight':false,'pointLightHelper':true,'pointLightColor':'#1E90FF','pointLightIntensity':10,'pointHorizontal':-4.21,'pointVertical':-4.1,'pointSistance':2.53,'spotLight':false,'spotLightColor':'#00BABD','spotLightIntensity':900,'spotHorizontal':-3.49,'spotVertical':-4.37,'spotSistance':4.09,'spotAngle':0.5,'spotPenumbra':1,'spotFocus':1,'spotCastShadow':true,'spotLightHelper':true,'spotDistance':20},'stage':{'meshPositonList':[{'name':'Mesh_0254_Tex_0253_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0258_Tex_0253_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0260_Tex_0253_0dd2_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0272_Tex_0271_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275001_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275002_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275003_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0272001_Tex_0271_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0254001_Tex_0253_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0258001_Tex_0253_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0272002_Tex_0271_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275004_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275005_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0275006_Tex_0271_0dd1_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}},{'name':'Mesh_0272003_Tex_0271_0dds_0','rotation':{'x':0,'y':0,'z':0},'scale':{'x':1,'y':1,'z':1},'position':{'x':0,'y':0,'z':0}}],'glow':false,'threshold':0.05,'strength':0.6,'radius':1,'decompose':0,'transformType':'translate','manageFlage':false,'toneMappingExposure':2,'color':''},'camera':{'x':0,'y':2,'z':6},'fileInfo':{'name':'变形金刚（3）','fileType':'glb','id':9,'animation':false,'filePath':'threeFile/glb/glb-9.glb','icon':'/three.js3d/static/img/4.0a19b0ab.png','decomposeName':'transformers_3','key':'transformers-3'}}" allowfullscreen></iframe>
  </div>
</template>
<script setup lang="jsx" name="modelBase">
import { local } from "@/utils/storage";
import { MODEL_PRIVEW_CONFIG } from "@/config/constant";
import { useRouter, useRoute } from "vue-router";
import { ref } from 'vue'
import createThreeDComponent from "@/utils/initThreeTemplate";
import { ElMessageBox } from 'element-plus'
const router = useRouter();
const route = useRoute();
const config = ref(null)

const urlParams = new URLSearchParams(window.location.search);
const modelConfigParam = urlParams.get('modelConfig');
console.log('modelConfigParam', modelConfigParam)

if (local.get(MODEL_PRIVEW_CONFIG)) {
  config.value = local.get(MODEL_PRIVEW_CONFIG)
} else if (modelConfigParam) {
  console.log(decodeURIComponent(modelConfigParam.replace(/'/g, '"')))
  const modelConfig = JSON.parse(decodeURIComponent(modelConfigParam.replace(/'/g, '"')));
  config.value = modelConfig

} else {
  ElMessageBox.alert(`当前页面出错,返回首页`, '提示', {
    confirmButtonText: '确认',
    type: 'warning'
  }).then(() => {
    router.push({ path: '/' })
  })
}

const treeComponent = createThreeDComponent(config.value);
</script>
<style lang="scss" scoped>
#preview {
  width: 100%;
  height: 100vh;
}
</style>
